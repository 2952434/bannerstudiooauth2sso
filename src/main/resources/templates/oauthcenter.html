<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>旗帜软件工作室授权中心</title>
    <link rel="stylesheet" href="../css/base.css">
    <link rel="shortcut icon" href="../img/favicon.ico"/>
    <link rel="stylesheet" href="../css/center.css">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!--    引入bootstrap-->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script type="text/javascript" src="https://repo.bfw.wiki/bfwrepo/js/jquery-3.2.1.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body class="starlight">
<div id="app">
    <div class="header">
        <div class="logo"><img src="../img/favicon.ico" alt=""></div>
        <div class="text">旗帜软件工作室授权中心</div>

    </div>
    <div class="container">
        <div class="row bgc" style="position: relative">
            <div style="display: inline-block"><p style="width: 200px;">应用授权</p></div>
            <div th:text="'该用户具有'+${authority}+'角色'"
                 style="display: inline-block;position: absolute;right: 5%;top: 40%;"></div>
        </div>
        <div class="row big" style="display: flex">
            <div class="content-left" style="width: 50%;border-right:1px dashed #b0b0b0;">
                <div style="text-align: center;margin-top: 20px;">
                    <h3>快速安全登录</h3>
                    <p>请点击头像授权登录</p>
                </div>
                <div class="only" style="width: 80px;height: 80px;margin: 30px 245px;border: 1px solid #ccc;cursor: pointer">
                    <form action="/oauth/authorize" method="post" style="border: none">
                        <input name="authorize" class="bgc1" type="submit" value=" " :style="{backgroundImage: 'url(' + this.imgUrl + ')'}">
                    </form>
<!--                    <div>-->
<!--                        <div th:each="item:${scopes}">-->
<!--                            <input type="checkbox" th:name="'scope.'+${item}" id="all" style="width: 14px;height: 14px;"-->
<!--                                   value="true" >-->
<!--                            <img src="../img/favicon.ico" alt="" @click="authorize" style="width: 100%;height: 100%;">-->
<!--                        </div>-->
<!--                    </div>-->
                </div>
                <div th:text="'您的用户名为'+${userName}" id="img" style="margin-top:10px;margin-left: 220px;"></div>
            </div>
            <div class="content-right" style="width: 50%;">
                <div th:text="${clientId}+'请求授权，该应用将获取你的以下信息'"
                     style="text-align: center;margin: 20px auto;font-size: 18px"></div>
                <!--                    <div th:value="${userName}" v-model="userName"></div>-->

                <div th:each="item:${scopes}">
                    <p class="one" style="text-align: center;margin: 10px auto">
                    <input type="checkbox" th:name="'scope.'+${item}" id="all" style="width: 14px;height: 14px;" value="true" checked><label for="all" style="cursor: pointer">全选</label>
                    </p>
                </div>
                <p style="text-align: center;margin: 10px auto">
                    <input type="checkbox" id="only" style="width: 14px;height: 14px;" disabled checked><label
                        for="only" style="cursor: pointer">昵称、头像、性别</label>
                </p>
                <p class="end" style="text-align: center;margin: 20px auto">授权后表明你已同意 <a href="javascript:;">旗帜软件工作室服务协议</a>
                </p>
            </div>
        </div>
        <!--            </div>-->
    </div>
</div>
<div class="banner" style="position: fixed;bottom: 0;">
    <ul>
        <li><a href="https://www.bannerstudio.club/">工作室官网</a></li>
        <li>|</li>
        <li><a href="javascript:;">意见反馈</a></li>
        <li>|</li>
        <li><a href="https://interview.bannerstudio.club/">工作室面试</a></li>
        <li>|</li>
        <li><a href="https://oa.bannerstudio.club/">工作室OA系统</a></li>
        <li>|</li>
        <li><a href="https://forum.bannerstudio.club/">工作室论坛</a></li>
    </ul>
    <p style="text-align: center;position: absolute;top: 70%;left: 28%;">版权所有@旗帜软件工作室 | 地址：河南省新乡市华兰大道东段河南科技学院 |
        邮编：453000 | 豫ICP备2021016204号</p>
</div>
</div>
<script>
    new Vue({
        el: '#app',
        data: function () {
            return {
                client_id: "",
                scope: "",
                userName: "",
                authority: "",
                requestUrl: "",
                redirectUrl: "",
                name : '',
                imgUrl:'',
            }
        },
        methods: {
            authorize() {
                var formData = new FormData();
                formData.append("user_oauth_approval", true);
                formData.append("authorize", true);
                formData.append(document.getElementById("all").getAttribute("name"),true)
                axios({
                    method: 'POST',
                    url: '/oauth/authorize',
                    data: formData,
                    headers: {
                        'Accept': 'application/json, text/javascript, */*; q=0.01',
                        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
                    }
                }).then(res => {
                    console.log(res)
                }).catch(err => {
                    console.log(err) // 后台报错返回
                })
            },
        },
        mounted() {
        },
        created() {
            this.name = document.getElementById("img").innerText
            var s2 = this.name.slice(6);
            console.log(s2)
            console.log(this.imgUrl)
            axios({
                method: 'get',
                url: '/user/head/'+s2,
                headers: {
                    'Accept': 'application/json, text/javascript, */*; q=0.01',
                    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
                }
            }).then(res => {
                console.log(res)
                // console.log(res.data.obj)
                this.imgUrl = res.data.obj
                if (this.imgUrl === null) {
                    this.imgUrl = "../img/favicon.ico"
                }
                console.log(this.imgUrl)
                console.log(res.data.status)
            }).catch(err => {
                console.log(err) // 后台报错返回
            })
            this.requestUrl = document.location.toString()
            console.log(this.requestUrl)

        }
    })
</script>
<script type="text/javascript" src="https://repo.bfw.wiki/bfwrepo/js/starlight.js"></script>
</body>
</html>